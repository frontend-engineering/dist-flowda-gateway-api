(()=>{"use strict";var e={7462:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AppController=void 0;const r=a(5584),o=a(3563);let i=class AppController{constructor(){}hi(){return r.__awaiter(this,void 0,void 0,(function*(){return{hi:"flowda-gateway-api"}}))}};t.AppController=i,r.__decorate([(0,o.Get)("/__hi"),r.__metadata("design:type",Function),r.__metadata("design:paramtypes",[]),r.__metadata("design:returntype",Promise)],i.prototype,"hi",null),t.AppController=i=r.__decorate([(0,o.Controller)("/apps"),r.__metadata("design:paramtypes",[])],i)},9238:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AppModule=void 0;const r=a(5584),o=a(3563),i=a(8781),n=a(7462),s=a(3016),c=a(2377);let d=class AppModule{};t.AppModule=d,t.AppModule=d=r.__decorate([(0,o.Module)({imports:[s.ServicesModule],controllers:[n.AppController],providers:[{provide:i.APP_PIPE,useClass:c.ZodValidationPipe}]})],d)},5381:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.loadModule=void 0;const r=a(4424),o=a(3563);console.log("---------- ENV --------------"),Object.keys(r.FLOWDA_GATEWAY_ENV).forEach((e=>console.log(e,r.FLOWDA_GATEWAY_ENV[e]))),console.log("---------- ENV --------------"),t.loadModule=function(e){e.load(r.flowdaGatewayTrpcServerModule),e.bind("Factory<Logger>").toFactory((e=>e=>new o.Logger(e)))}},3016:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ServicesModule=t.servicesContainer=void 0;const r=a(5584),o=a(3563),i=a(5337),n=a(7967),s=a(5381);t.servicesContainer=new i.Container,(0,s.loadModule)(t.servicesContainer);const c=(0,n.getServices)(t.servicesContainer);let d=class ServicesModule{constructor(){}};t.ServicesModule=d,t.ServicesModule=d=r.__decorate([(0,o.Global)(),(0,o.Module)({providers:c,exports:c}),r.__metadata("design:paramtypes",[])],d)},6482:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.axiosApiInstance=void 0;const r=a(5584),o=r.__importDefault(a(8938)),i=r.__importStar(a(8340)),n=r.__importDefault(a(9797));t.axiosApiInstance=o.default.create(),t.axiosApiInstance.interceptors.request.use((e=>r.__awaiter(void 0,void 0,void 0,(function*(){if(null==e.url)return e;console.info("url        :",e.url);const[t,a]=e.url.split("?");return n.default.info(`request : ${e.method} ${t}`),n.default.info("query   : "),console.log(JSON.stringify(i.parse(a))),n.default.info("data    : "),console.log(JSON.stringify(e.data)),e}))),(e=>{Promise.reject(e)})),t.axiosApiInstance.interceptors.response.use((e=>(n.default.info(`response: ${e.config.url}`),console.log(JSON.stringify(e.data)),e)),(function(e){return r.__awaiter(this,void 0,void 0,(function*(){return Promise.reject(e)}))}))},1192:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FLOWDA_GATEWAY_ENV=void 0;const r=a(3238),o=a(1569);t.FLOWDA_GATEWAY_ENV=(0,r.parseEnv)(process.env,{ACCESS_TOKEN_SECRET:o.z.string().min(1),FLOWDA_URL:o.z.string().min(1),CMS_ADMIN_URL:o.z.string().min(1),YONGCHENG_URL:o.z.string().min(1),TIANBAO_URL:o.z.string().min(1)})},6989:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.flowdaGatewayTrpcServerModule=void 0;const r=a(5337),o=a(7967),i=a(3558),n=a(5792),s=a(2838),c=a(6871),d=a(6185),m=a(1192),l=a(6482);t.flowdaGatewayTrpcServerModule=new r.ContainerModule((e=>{e(d.AxiosInstanceSymbol).toConstantValue(l.axiosApiInstance),e(d.GatewayRegisterSymbol).to(c.GatewayRegister).inSingletonScope().onActivation(((e,t)=>(t.register([{id:"superadmin",name:"\u57fa\u7840\u670d\u52a1",trpcEndpoint:`${m.FLOWDA_GATEWAY_ENV.FLOWDA_URL}/flowda-api/trpc`},{id:"cms_admin",name:"CMS \u7ba1\u7406\u540e\u53f0",trpcEndpoint:`${m.FLOWDA_GATEWAY_ENV.CMS_ADMIN_URL}/cms-admin-api/trpc`},{id:"ycdev",name:"\u6c38\u6210\u6d4b\u8bd5",trpcEndpoint:`${m.FLOWDA_GATEWAY_ENV.YONGCHENG_URL}/yongcheng-api/trpc`},{id:"tianbao_uat",name:"\u5929\u5b9dUAT",trpcEndpoint:`${m.FLOWDA_GATEWAY_ENV.TIANBAO_URL}/api/trpc`}]),t))),e(i.TrpcService).toSelf().inSingletonScope(),e(s.ContextFactory).toSelf().inSingletonScope(),e(c.HelloRouter).toSelf().inSingletonScope(),(0,o.bindService)(e,n.TrpcRouter)}))},4424:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=a(5584);r.__exportStar(a(6989),t),r.__exportStar(a(5792),t),r.__exportStar(a(1192),t)},6693:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.flowdaTrpc=void 0;const r=a(5584),o=a(7455),i=a(1192);t.flowdaTrpc=(0,o.createTRPCProxyClient)({links:[(0,o.httpBatchLink)({url:`${i.FLOWDA_GATEWAY_ENV.FLOWDA_URL}/flowda-api/trpc`,headers(){return r.__awaiter(this,void 0,void 0,(function*(){return{"x-from":"flowda-gateway"}}))}})],transformer:{input:{serialize:e=>e,deserialize:e=>e},output:{serialize:e=>e,deserialize:e=>e}}})},6871:(e,t,a)=>{var r,o;Object.defineProperty(t,"__esModule",{value:!0}),t.HelloRouter=t.GatewayRegister=void 0;const i=a(5584),n=a(5337),s=a(3558),c=a(1569),d=a(6693),m=a(6185),l=a(2409),u=a(1717),p=a(3169);let h=class GatewayRegister{constructor(e){this._services=[],this.logger=e(S.name)}register(e){Array.isArray(e)?e.forEach((e=>this.registerItem(e))):this.registerItem(e)}registerItem(e){this._services.find((t=>t.id===e.id))?this.logger.warn(`service ${e.id} is already registered`):this._services.push(e)}get services(){return this._services}getTrpc(e){const t=this._services.find((t=>t.id===e));if(!t)throw new Error(`Not found ${e}`);return t}};t.GatewayRegister=h,t.GatewayRegister=h=i.__decorate([(0,n.injectable)(),i.__param(0,(0,n.inject)("Factory<Logger>")),i.__metadata("design:paramtypes",[Function])],h);let S=r=class HelloRouter{constructor(e,t,a,o){this.trpc=e,this.axios=t,this.gatewayRegister=a,this.helloRouter=this.trpc.router({validate:this.trpc.procedure.input(c.z.object({username:c.z.string(),password:c.z.string()})).mutation((e=>i.__awaiter(this,[e],void 0,(function*({input:e}){return yield d.flowdaTrpc.user.validate.mutate(e)})))),createRoot:this.trpc.procedure.input(c.z.any()).query((e=>i.__awaiter(this,void 0,void 0,(function*(){return{id:"WorkspaceNodeId",name:"WorkspaceNode",visible:!1,children:this.gatewayRegister.services.map((e=>{const{trpcEndpoint:t}=e,a=i.__rest(e,["trpcEndpoint"]);return Object.assign(Object.assign({},a),{selected:!1,expanded:!1,children:[]})}))}})))),resolveChildren:this.trpc.protectedProcedure.input(c.z.object({pid:c.z.string()})).query((e=>i.__awaiter(this,void 0,void 0,(function*(){const[t,a]=e.input.pid.split("."),r=yield d.flowdaTrpc.menu.getMenuByTenantName.query({tenantName:t});return(0,u.convertMenuToTheia)({tenantName:t,parentId:a,menuData:r})})))),getResourceSchema:this.trpc.protectedProcedure.input(c.z.object({schemaName:c.z.string()})).query((e=>i.__awaiter(this,[e],void 0,(function*({input:e,ctx:t}){const[a,r]=e.schemaName.split("."),o=this.gatewayRegister.getTrpc(a),i=(yield this.axios.request({url:`${o.trpcEndpoint}/schema.getSchemaCache?input={}`,method:"get"})).data.result.data[r];return i.namespace=a,i})))),getResourceData:this.trpc.protectedProcedure.input(p.getResourceDataInputSchema).query((e=>i.__awaiter(this,[e],void 0,(function*({input:e,ctx:t}){const[a,r]=e.schemaName.split("."),o=yield this.getSchema(a,r),i=p.findUniqueResourceDataInputSchema.safeParse(e),n=p.findManyResourceDataInputSchema.safeParse(e);let s,c;if(i.success)c=`${o.slug}/${i.data.id}`,s={};else{if(!n.success)throw new Error("getResourceData input parse error");c=o.slug,s={pageSize:n.data.pageSize,current:n.data.current,sort:(0,l.convertSortAgToMotor)(n.data.sort),filterModel:n.data.filterModel}}const d=this.gatewayRegister.getTrpc(a);return(yield this.axios.request({method:"get",url:`${d.trpcEndpoint}/data.get?input=${encodeURIComponent(JSON.stringify({user:t.user,path:c,query:s}))}`})).data.result.data})))),putResourceData:this.trpc.protectedProcedure.input(c.z.object({schemaName:c.z.string(),id:c.z.number(),updatedValue:c.z.any()})).mutation((e=>i.__awaiter(this,[e],void 0,(function*({input:e,ctx:t}){const[a,r]=e.schemaName.split("."),o=`${(yield this.getSchema(a,r)).slug}/${e.id}`,i=this.gatewayRegister.getTrpc(a);return(yield this.axios.request({method:"post",url:`${i.trpcEndpoint}/data.put`,data:{user:t.user,path:o,values:e.updatedValue}})).data.result.data}))))}),this.logger=o(r.name)}getSchema(e,t){return i.__awaiter(this,void 0,void 0,(function*(){const a=this.gatewayRegister.getTrpc(e);return(yield this.axios.request({url:`${a.trpcEndpoint}/schema.getSchemaCache?input={}`,method:"get"})).data.result.data[t]}))}};t.HelloRouter=S,t.HelloRouter=S=r=i.__decorate([(0,n.injectable)(),i.__param(0,(0,n.inject)(s.TrpcService)),i.__param(1,(0,n.inject)(m.AxiosInstanceSymbol)),i.__param(2,(0,n.inject)(m.GatewayRegisterSymbol)),i.__param(3,(0,n.inject)("Factory<Logger>")),i.__metadata("design:paramtypes",["function"==typeof(o=void 0!==s.TrpcService&&s.TrpcService)?o:Object,Object,h,Function])],S)},1717:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.traverse=t.convertMenuToTheia=t.mapMenuItemToTheiaMenu=void 0;const r=a(2409);function o(e){const{tenantName:t,menuItem:a}=e;return{id:`${t}.${a.slug}`,name:a.name,selected:!1,uri:Array.isArray(a.children)&&a.children.length>0?void 0:`grid://${t}?schemaName=${(0,r.toSchemaName)(a.slug)}&displayName=${a.name}`,expanded:!(Array.isArray(a.children)&&a.children.length>0)&&void 0,children:Array.isArray(a.children)&&a.children.length>0?[]:void 0}}function i(e,t){var a;t(e),e.children&&Array.isArray(e.children)&&e.children.length>0&&(null===(a=e.children)||void 0===a||a.forEach((e=>{i(e,t)})))}t.mapMenuItemToTheiaMenu=o,t.convertMenuToTheia=function(e){const{tenantName:t,parentId:a,menuData:r}=e;if(null==a){return r.map((e=>o({tenantName:t,menuItem:e})))}{let e;return r.forEach((r=>i(r,(r=>{r.slug===a&&Array.isArray(r.children)&&(e=r.children.map((e=>o({tenantName:t,menuItem:e}))))})))),e}},t.traverse=i},2838:(e,t,a)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.ContextFactory=void 0;const o=a(5584),i=a(5337),n=a(7967);let s=r=class ContextFactory{constructor(e){this.createContext=e=>o.__awaiter(this,void 0,void 0,(function*(){const t=(0,n.createContext)(e);return(0,n.diag)(t,"[createContext]"),t})),this.logger=e(r.name)}};t.ContextFactory=s,t.ContextFactory=s=r=o.__decorate([(0,i.injectable)(),o.__param(0,(0,i.inject)("Factory<Logger>")),o.__metadata("design:paramtypes",[Function])],s)},5792:(e,t,a)=>{var r,o,i,n;Object.defineProperty(t,"__esModule",{value:!0}),t.TrpcRouter=void 0;const s=a(5584),c=a(5337),d=a(3558),m=s.__importStar(a(6951)),l=a(2838),u=a(6871);let p=r=class TrpcRouter{constructor(e,t,a,o){this.trpc=e,this.helloRouter=t,this.contextFactory=a,this.appRouter=this.trpc.router({hello:this.helloRouter.helloRouter}),this.logger=o(r.name)}applyMiddleware(e,t){this.logger.log(`applyMiddleware ${t}/trpc`),e.use(`/${t}/trpc`,m.createExpressMiddleware({router:this.appRouter,createContext:this.contextFactory.createContext}))}};t.TrpcRouter=p,t.TrpcRouter=p=r=s.__decorate([(0,c.injectable)(),s.__param(0,(0,c.inject)(d.TrpcService)),s.__param(1,(0,c.inject)(u.HelloRouter)),s.__param(2,(0,c.inject)(l.ContextFactory)),s.__param(3,(0,c.inject)("Factory<Logger>")),s.__metadata("design:paramtypes",["function"==typeof(o=void 0!==d.TrpcService&&d.TrpcService)?o:Object,"function"==typeof(i=void 0!==u.HelloRouter&&u.HelloRouter)?i:Object,"function"==typeof(n=void 0!==l.ContextFactory&&l.ContextFactory)?n:Object,Function])],p)},3558:(e,t,a)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.processAt=t.TrpcService=void 0;const o=a(5584),i=a(3611),n=a(5337),s=a(7967),c=a(6693),d=a(3169);let m=r=class TrpcService{constructor(e){this.trpc=i.initTRPC.context().create({transformer:s.transformer,errorFormatter:s.errorFormatter}),this.procedure=this.trpc.procedure,this.protectedProcedure=this.trpc.procedure.use((function(e){return o.__awaiter(this,void 0,void 0,(function*(){const t=e.ctx;let a;(0,s.diag)(t,"[protectedProcedure]");const r=l(t.req.headers.authorization);if((0,s.diag)(t,"processAt",{at:r}),r)try{const e=yield c.flowdaTrpc.user.verifyAccessToken.query({jwt:r});(0,s.diag)(t,"flowdaTrpc.user.verifyAccessToken",e);const o=yield c.flowdaTrpc.user.findUnique.query({id:e.uid});a=d.ctxUserSchema.parse(o)}catch(o){(0,s.diag)(t,"flowdaTrpc.user.verifyAccessToken",o)}if(!a)throw new i.TRPCError({code:"UNAUTHORIZED"});return t.user=a,e.next({ctx:t})}))})),this.router=this.trpc.router,this.mergeRouters=this.trpc.mergeRouters,this.logger=e(r.name)}};function l(e){if("string"!=typeof e)return;if(null==e.split(" ")[1])return;let t=e.split(" ")[1];return""!==t.trim()&&(t=t.trim(),"undefined"!==t&&"null"!==t)?t:void 0}t.TrpcService=m,t.TrpcService=m=r=o.__decorate([(0,n.injectable)(),o.__param(0,(0,n.inject)("Factory<Logger>")),o.__metadata("design:paramtypes",[Function])],m),t.processAt=l},6185:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const r=a(5584);r.__exportStar(a(9528),t),r.__exportStar(a(3628),t),r.__exportStar(a(7335),t),r.__exportStar(a(4219),t),r.__exportStar(a(128),t)},9528:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AxiosInstanceSymbol=t.GatewayRegisterSymbol=t.WechatpayNodeV3FactorySymbol=t.WechatpayNodeV3Symbol=t.MenuServiceSymbol=t.DynamicTableDefServiceSymbol=t.DynamicTableDataServiceSymbol=t.WechatOAuthSymbol=t.SmsClientSymbol=t.COSSymbol=t.K3CloudIdentifyInfoSymbol=t.ENVSymbol=t.URLSymbol=t.APISymbol=t.FlowdaTrpcClientSymbol=t.DynamicTableSchemaTransformerSymbol=t.SchemaServiceSymbol=t.LegacySchemaServiceSymbol=t.DataServiceSymbol=t.PrismaUtilsSymbol=t.SchemaTransformerSymbol=t.PrismaSchemaServiceSymbol=void 0,t.PrismaSchemaServiceSymbol=Symbol.for("PrismaSchemaService"),t.SchemaTransformerSymbol=Symbol.for("SchemaTransformer"),t.PrismaUtilsSymbol=Symbol.for("PrismaUtils"),t.DataServiceSymbol=Symbol.for("DataService"),t.LegacySchemaServiceSymbol=Symbol.for("LegacySchemaService"),t.SchemaServiceSymbol=Symbol.for("SchemaService"),t.DynamicTableSchemaTransformerSymbol=Symbol.for("DynamicTableSchemaTransformer"),t.FlowdaTrpcClientSymbol=Symbol.for("FlowdaTrpcClient"),t.APISymbol=Symbol("API"),t.URLSymbol=Symbol.for("URL"),t.ENVSymbol=Symbol.for("ENV"),t.K3CloudIdentifyInfoSymbol=Symbol.for("K3CloudIdentifyInfo"),t.COSSymbol=Symbol("COS"),t.SmsClientSymbol=Symbol.for("SmsClient"),t.WechatOAuthSymbol=Symbol.for("WechatOAuth"),t.DynamicTableDataServiceSymbol=Symbol.for("DynamicTableDataService"),t.DynamicTableDefServiceSymbol=Symbol.for("DynamicTableDefService"),t.MenuServiceSymbol=Symbol.for("MenuService"),t.WechatpayNodeV3Symbol=Symbol.for("WechatpayNodeV3Symbol"),t.WechatpayNodeV3FactorySymbol=Symbol.for("WechatpayNodeV3FactorySymbol"),t.GatewayRegisterSymbol=Symbol.for("GatewayRegister"),t.AxiosInstanceSymbol=Symbol.for("AxiosInstance")},3628:(e,t)=>{var a;Object.defineProperty(t,"__esModule",{value:!0}),t.Serial_Max=t.Serial_Min=t.EPlan=void 0,function(e){e[e.Free=1]="Free",e[e.VIP=2]="VIP"}(a||(t.EPlan=a={})),t.Serial_Min=10001,t.Serial_Max=99999},128:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createZodDto=void 0,t.createZodDto=function(e){class AugmentedZodDto{static create(e){return this.schema.parse(e)}}return AugmentedZodDto.isZodDto=!0,AugmentedZodDto.schema=e,AugmentedZodDto}},4219:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getQmsStatusByDocumentCodeType1Res=t.getTodoPreReceiptInventoryFormRes=t.sapGetQualityAssurance=t.todo=t.oaRequestMaxStockApprove=t.sapCheckMinMaxRes=t.sapCheckMinMax=t.oaNotPass=t.oaRequestMaterialNoExceedRequirement=t.apsCheckMaterialRequirement=t.srmGetDeliverDocListByCodeOkRes=t.srmGetDeliverDocListByCode=t.materialCode=t.notOkResponse=t.okResponse=t.callbackNoticePlasticIntoStockInputSchema=t.wcsNoticeProductOutStockSchema=t.wcsNoticeProduceReturnSchema=t.wcsNoticePlasticIntoStockSchema=t.wcsNoticeProductIntoStockSchema=t.wcsNoticeMaterialSendSchema=t.wmsMouldFinishSchema=t.wmsMouldGetMouldTypeOutput2Schema=t.wmsMouldGetMouldTypeOutput1Schema=t.wmsMouldGetMouldTypeSchema=t.wcsNoticeMouldOutStockSchema=t.wcsNoticeMouldIntoStockSchema=t.wmsSaleOutWarehouseSchema=t.wmsPurchaseReturnOutWarehouseSchema=t.wmsProduceOutWarehouseSchema=t.wmsOtherOutWarehouseSchema=t.wmsOEMOutWarehouseSchema=t.wmsOEMAddOutWarehouseSchema=t.wmsUpdateWarehousingAuditToErpSchema=t.wmsPRDFeedMtrlSchema=t.wmsSubReturnWarehousingSchema=t.wmsPurchaseWarehousingSchema=t.wmsProduceWarehousingSchema=t.wmsProduceReturnWarehousingSchema=t.wmsOtherWarehousingSchema=t.wmsOEMWarehousingSchema=t.wmsOEMReturnSchema=t.wmsWarehousingItemSchema=t.wmsGoodsTypeSchema=t.wmsSupplierSchema=t.wmsStockSchema=t.wmsGoodsUtilSchema=t.wmsGoodsMslSchema=t.wmsGoodsSchema=t.wmsCustomerSchema=void 0,t.getMaterialReturnRequestRes=t.getQmsStatusByDocumentCodeType4Res=t.getQmsStatusByDocumentCodeType3Res=t.getQmsStatusByDocumentCodeType2Res=void 0;const r=a(7967),o=a(1569);(0,r.extendZod)(o.z),t.wmsCustomerSchema=o.z.object({customerCode:o.z.string().openapi({description:"\u5ba2\u6237\u7f16\u53f7"}),customerName:o.z.string().openapi({description:"\u5ba2\u6237\u540d\u79f0"}),masterId:o.z.string().openapi({description:"\u8d27\u4e3bid"}),contact:o.z.string().openapi({description:"\u8054\u7cfb\u4eba"}),contactInfo:o.z.string().openapi({description:"\u8054\u7cfb\u65b9\u5f0f"}),status:o.z.union([o.z.literal(1),o.z.literal(9)]).openapi({description:"\u72b6\u60011\u3001\u542f\u7528 0\u3001\u7981\u7528"}),organizationId:o.z.string().openapi({description:"\u7ec4\u7ec7Id"})}),t.wmsGoodsSchema=o.z.object({goodsCode:o.z.string().openapi({description:"\u8d27\u7269\u7f16\u53f7"}),goodsName:o.z.string().openapi({description:"\u8d27\u7269\u540d\u79f0"}),goodsTypeId:o.z.string().openapi({description:"\u8d27\u7269\u7c7b\u578bid"}),goodsAttribute:o.z.string().openapi({description:"\u8d27\u7269\u5c5e\u6027"}),masterId:o.z.string().openapi({description:"\u8d27\u4e3b\u4fe1\u606f"}),specification:o.z.string().openapi({description:"\u89c4\u683c\u578b\u53f7"}),measurementUnit:o.z.string().openapi({description:"\u8ba1\u91cf\u5355\u4f4d"}),goodsPackageId:o.z.string().openapi({description:"\u5305\u88c5\u89c4\u683cid"}),batchId:o.z.string().openapi({description:"\u6279\u6b21id"}),goodsInspectMode:o.z.number().openapi({description:"\u8d27\u7269\u68c0\u9a8c\u65b9\u5f0f1\u3001\u5168\u68c02\u3001\u62bd\u68c03\u3001\u514d\u68c0"}),length:o.z.number().openapi({description:"\u957f"}),width:o.z.number().openapi({description:"\u5bbd"}),high:o.z.number().openapi({description:"\u9ad8"}),volume:o.z.number().openapi({description:"\u4f53\u79ef"}),grossWeight:o.z.number().openapi({description:"\u6bdb\u91cd"}),netWeight:o.z.number().openapi({description:"\u51c0\u91cd"}),minStock:o.z.number().openapi({description:"\u6700\u4f4e\u5e93\u5b58"}),maxStock:o.z.number().openapi({description:"\u6700\u9ad8\u5e93\u5b58"}),maxStorageTime:o.z.number().openapi({description:"\u6700\u957f\u50a8\u5b58\u65f6\u95f4"}),isAuto:o.z.number().openapi({description:"\u662f\u5426\u81ea\u52a8\u53161\u3001\u662f 0\u3001\u5426"}),choppedQuantity:o.z.number().openapi({description:"\u5241\u578b\u6bcf\u5c42\u6570\u91cf"}),choppedLayer:o.z.number().openapi({description:"\u5241\u578b\u5c42\u6570"}),goodsPicture:o.z.string().openapi({description:"\u8d27\u7269\u56fe\u7247"}),fSeitBrand:o.z.string().openapi({description:"\u54c1\u724c"}),fSeitCasePackage:o.z.string().openapi({description:"\u5c01\u88c5"}),fSeitMsl:o.z.string().openapi({description:"MSL"}),fRefCost:o.z.string().openapi({description:"\u5355\u4f4d\u6210\u672c"}),fSeitMpn:o.z.string().openapi({description:"MPN"}),status:o.z.number().openapi({description:"\u72b6\u60011\u3001\u542f\u7528 0\u3001\u7981\u7528"}),organizationId:o.z.number().openapi({description:"\u7ec4\u7ec7id"})}),t.wmsGoodsMslSchema=o.z.object({mslCode:o.z.string().openapi({description:"MSL"})}),t.wmsGoodsUtilSchema=o.z.object({unitId:o.z.string().openapi({description:"\u8ba1\u91cf\u5355\u4f4did"}),name:o.z.string().openapi({description:"\u8ba1\u91cf\u5355\u4f4d\u540d\u79f0"}),code:o.z.string().openapi({description:"\u8ba1\u91cf\u5355\u4f4dcode"})}),t.wmsStockSchema=o.z.object({id:o.z.string().openapi({description:"erp\u4ed3\u5e93id"}),code:o.z.string().openapi({description:"erp\u4ed3\u5e93\u7f16\u7801"})}),t.wmsSupplierSchema=o.z.object({supplierCode:o.z.string().openapi({description:"\u4f9b\u5e94\u5546\u7f16\u53f7"}),supplierName:o.z.string().openapi({description:"\u4f9b\u5e94\u5546\u540d\u79f0"}),masterId:o.z.string().openapi({description:"\u8d27\u4e3bid"}),contact:o.z.string().openapi({description:"\u8054\u7cfb\u4eba"}),contactInfo:o.z.string().openapi({description:"\u8054\u7cfb\u65b9\u5f0f"}),remark:o.z.string().openapi({description:"\u5907\u6ce8"}),status:o.z.number().openapi({description:"\u72b6\u60011\u3001\u542f\u7528 0\u3001\u7981\u7528"}),organizationId:o.z.string().openapi({description:"\u7ec4\u7ec7Id"})}),t.wmsGoodsTypeSchema=o.z.object({goodsTypeCode:o.z.string().openapi({description:"\u8d27\u7269\u7c7b\u578b\u7f16\u53f7"}),goodsTypeName:o.z.string().openapi({description:"\u8d27\u7269\u7c7b\u578b\u540d\u79f0"}),status:o.z.number().openapi({description:"\u72b6\u60011\u3001\u542f\u7528 0\u3001\u7981\u7528"}),organizationId:o.z.string().openapi({description:"\u7ec4\u7ec7Id"})}),t.wmsWarehousingItemSchema=o.z.object({FBillNo:o.z.string().openapi({description:"\u5355\u636e\u53f7"}),FDate:o.z.string().openapi({description:"\u5165\u5e93\u65e5\u671f"}),FDocumentStatus:o.z.string().openapi({description:"\u5355\u636e\u72b6\u6001 Z\uff1a\u6682\u5b58\uff0cA\uff1a\u521b\u5efa\uff0cB\uff1a\u5ba1\u6838\uff0cC\uff1a\u5df2\u5ba1\u6838\uff0cD\uff1a\u91cd\u65b0\u5ba1\u6838"}),FMaterialId:o.z.string().openapi({description:"\u7269\u6599\u7f16\u7801"}),FQty:o.z.string().openapi({description:"\u6570\u91cf"}),FLot:o.z.string().openapi({description:"\u6279\u6b21\u53f7"}),FStockId:o.z.string().openapi({description:"\u4ed3\u5e93\u7f16\u7801"})}),t.wmsOEMReturnSchema=o.z.array(t.wmsWarehousingItemSchema),t.wmsOEMWarehousingSchema=o.z.array(t.wmsWarehousingItemSchema),t.wmsOtherWarehousingSchema=o.z.array(t.wmsWarehousingItemSchema.extend({FSupplierId:o.z.string().openapi({description:"\u4f9b\u5e94\u5546\u7f16\u7801"})})),t.wmsProduceReturnWarehousingSchema=o.z.array(t.wmsWarehousingItemSchema.extend({FAPPQty:o.z.string().openapi({description:"\u7533\u8bf7\u6570\u91cf"}),FQty:o.z.string().openapi({description:"\u5b9e\u9000\u6570\u91cf"})})),t.wmsProduceWarehousingSchema=o.z.array(t.wmsWarehousingItemSchema.omit({FQty:!0}).extend({FMustQty:o.z.string().openapi({description:"\u5e94\u6536\u6570\u91cf"}),FRealQty:o.z.string().openapi({description:"\u5b9e\u6536\u6570\u91cf"})})),t.wmsPurchaseWarehousingSchema=o.z.array(t.wmsWarehousingItemSchema.omit({FQty:!0}).extend({FMustQty:o.z.string().openapi({description:"\u5e94\u6536\u6570\u91cf"}),FRealQty:o.z.string().openapi({description:"\u5b9e\u6536\u6570\u91cf"}),FSupplierId:o.z.string().openapi({description:"\u4f9b\u5e94\u5546\u7f16\u7801"})})),t.wmsSubReturnWarehousingSchema=o.z.array(t.wmsWarehousingItemSchema.extend({FAPPQty:o.z.string().openapi({description:"\u7533\u8bf7\u6570\u91cf"}),FQty:o.z.string().openapi({description:"\u5b9e\u9000\u6570\u91cf"})})),t.wmsPRDFeedMtrlSchema=o.z.array(t.wmsWarehousingItemSchema.extend({FActualQty:o.z.string().openapi({description:"\u5b9e\u53d1\u6570\u91cf"})})),t.wmsUpdateWarehousingAuditToErpSchema=o.z.object({orderType:o.z.number().openapi({description:"\u5355\u636e\u7c7b\u578b"}),sourceOrderCode:o.z.string().openapi({description:"\u6765\u6e90\u5355\u636e"})}),t.wmsOEMAddOutWarehouseSchema=o.z.array(t.wmsWarehousingItemSchema.omit({FQty:!0}).extend({FActualQty:o.z.string().openapi({description:"\u5b9e\u53d1\u6570\u91cf"})})),t.wmsOEMOutWarehouseSchema=o.z.array(t.wmsWarehousingItemSchema.omit({FQty:!0}).extend({FActualQty:o.z.string().openapi({description:"\u5b9e\u53d1\u6570\u91cf"})})),t.wmsOtherOutWarehouseSchema=o.z.array(t.wmsWarehousingItemSchema),t.wmsProduceOutWarehouseSchema=o.z.array(t.wmsWarehousingItemSchema.omit({FQty:!0}).extend({FActualQty:o.z.string().openapi({description:"\u5b9e\u53d1\u6570\u91cf"})})),t.wmsPurchaseReturnOutWarehouseSchema=o.z.array(t.wmsWarehousingItemSchema.omit({FQty:!0}).extend({FRMREALQTY:o.z.string().openapi({description:"\u5b9e\u9000\u6570\u91cf"})})),t.wmsSaleOutWarehouseSchema=o.z.array(t.wmsWarehousingItemSchema.omit({FQty:!0}).extend({FCustomerID:o.z.string().openapi({description:"\u5ba2\u6237\u7f16\u7801"}),FRealQty:o.z.string().openapi({description:"\u5b9e\u53d1\u6570\u91cf"})})),t.wcsNoticeMouldIntoStockSchema=o.z.object({noticeId:o.z.number().openapi({description:"\u5355\u636e\u53f7",example:"XSCK00001"}),goodsList:o.z.array(o.z.object({containerCode:o.z.string().openapi({description:"\u7bb1\u7801",example:"containerCode"})}))}).openapi({title:"wcsNoticeMouldIntoStockSchema",example:{noticeId:"\u5355\u636e\u53f7"}}),t.wcsNoticeMouldOutStockSchema=o.z.object({noticeId:o.z.number().openapi({description:"\u5355\u636e\u53f7"}),goodsList:o.z.array(o.z.object({containerCode:o.z.string().openapi({description:"\u7bb1\u7801"}),startLoc:o.z.string().optional().openapi({description:"\u6a21\u5177\u6e90\u5e93\u4f4d"})}))}),t.wmsMouldGetMouldTypeSchema=o.z.object({noticeId:o.z.number().openapi({description:"\u5355\u636e\u53f7"}),containerCode:o.z.string().openapi({description:"\u5355\u4e2a\u7bb1\u7801"}),loc:o.z.string().optional().openapi({description:"\u5355\u4e2a\u7bb1\u5e93\u4f4d"}),type:o.z.union([o.z.literal("\u7c7b\u578b1"),o.z.literal("\u7c7b\u578b2"),o.z.literal("\u7c7b\u578b3")])}),t.wmsMouldGetMouldTypeOutput1Schema=o.z.object({success:o.z.boolean().openapi({example:"true"}),noticeId:o.z.number().openapi({description:"\u5355\u636e\u53f7"}),containerCode:o.z.string().openapi({description:"\u5355\u4e2a\u7bb1\u7801"}),startLoc:o.z.string().optional().openapi({description:"\u7bb1\u521d\u59cb\u5e93\u4f4d"}),type:o.z.union([o.z.literal("\u7c7b\u578b1"),o.z.literal("\u7c7b\u578b2"),o.z.literal("\u7c7b\u578b3")]),endLoc:o.z.string().optional().openapi({description:"\u7bb1\u76ee\u6807\u5e93\u4f4d"})}),t.wmsMouldGetMouldTypeOutput2Schema=o.z.object({success:o.z.boolean().openapi({example:"false"}),message:o.z.string().openapi({description:"\u5931\u8d25\u539f\u56e0"})}),t.wmsMouldFinishSchema=o.z.object({noticeId:o.z.number().openapi({description:"\u5355\u636e\u53f7"}),containerCode:o.z.string().openapi({description:"\u5355\u4e2a\u7bb1\u7801"}),startLoc:o.z.string().optional().openapi({description:"\u7bb1\u521d\u59cb\u5e93\u4f4d"}),endLoc:o.z.string().optional().openapi({description:"\u7bb1\u76ee\u6807\u5e93\u4f4d"}),type:o.z.union([o.z.literal("\u7c7b\u578b1"),o.z.literal("\u7c7b\u578b2"),o.z.literal("\u7c7b\u578b3")])}),t.wcsNoticeMaterialSendSchema=o.z.object({noticeId:o.z.number().openapi({description:"\u5355\u636e\u53f7"}),goodsList:o.z.array(o.z.object({containerCode:o.z.string().openapi({description:"\u7bb1\u7801"}),startLoc:o.z.string().optional().openapi({description:"\u7bb1\u521d\u59cb\u5e93\u4f4d"}),endLoc:o.z.string().optional().openapi({description:"\u7bb1\u76ee\u6807\u5e93\u4f4d"})}))}),t.wcsNoticeProductIntoStockSchema=o.z.object({noticeId:o.z.number().openapi({description:"\u5355\u636e\u53f7"}),goodsList:o.z.array(o.z.object({containerCode:o.z.string().openapi({description:"\u7bb1\u7801"}),endLoc:o.z.string().optional().openapi({description:"\u7bb1\u76ee\u6807\u5e93\u4f4d"})}))}),t.wcsNoticePlasticIntoStockSchema=o.z.object({noticeId:o.z.number().openapi({description:"\u5355\u636e\u53f7"}),containerCode:o.z.string().openapi({description:"\u7bb1\u7801"}),endLoc:o.z.string().optional().openapi({description:"\u7bb1\u76ee\u6807\u5e93\u4f4d"}),instructionType:o.z.union([o.z.literal("\u4e0a\u67b6\u6307\u4ee41"),o.z.literal("\u4e0a\u67b6\u6307\u4ee42"),o.z.literal("\u4e0a\u67b6\u6307\u4ee43"),o.z.literal("\u4e0a\u67b6\u6307\u4ee44")])}),t.wcsNoticeProduceReturnSchema=o.z.object({noticeId:o.z.number().openapi({description:"\u5355\u636e\u53f7"}),goodsList:o.z.array(o.z.object({containerCode:o.z.string().openapi({description:"\u7bb1\u7801"}),endLoc:o.z.string().optional().openapi({description:"\u7bb1\u76ee\u6807\u5e93\u4f4d"})}))}),t.wcsNoticeProductOutStockSchema=o.z.object({noticeId:o.z.number().openapi({description:"\u5355\u636e\u53f7"}),goodsList:o.z.array(o.z.object({containerCode:o.z.string().openapi({description:"\u7bb1\u7801"}),startLoc:o.z.string().optional().openapi({description:"\u7bb1\u521d\u59cb\u5e93\u4f4d"}),endLoc:o.z.string().optional().openapi({description:"\u7bb1\u76ee\u6807\u5e93\u4f4d"})}))}),t.callbackNoticePlasticIntoStockInputSchema=o.z.object({containerCode:o.z.string().openapi({description:"\u7bb1\u7801"})}),t.okResponse=o.z.object({success:o.z.literal(!0),message:o.z.string()}).openapi({title:"okResponse"}),t.notOkResponse=o.z.object({success:o.z.literal(!1),message:o.z.string()}).openapi({title:"notOkResponse"}),t.materialCode=o.z.string().openapi({example:"todo",description:"\u7269\u6599\u7f16\u7801"});const i=o.z.string().openapi({example:"",description:"\u5355\u636e\u53f7"});t.srmGetDeliverDocListByCode=o.z.object({materialCode:t.materialCode}).openapi({title:"srmGetDeliverDocListByCode",description:"\u7269\u6599\u7f16\u7801\u4ece\u4e8c\u7ef4\u7801\u63d0\u53d6"}),t.srmGetDeliverDocListByCodeOkRes=o.z.object({documentCode:o.z.string().openapi({example:"todo",description:"\u9001\u8d27\u5355\u53f7"}),materialList:o.z.array(o.z.object({materialCode:o.z.string().openapi({description:"\u7269\u6599\u7f16\u7801",example:"todo"}),type:o.z.string().openapi({description:"\u7269\u6599\u7c7b\u578b\uff08\u533a\u5206 VMI\uff09",example:"todo"})}))}).openapi({title:"srmGetDeliverDocListByCodeOkRes",description:"todo"}),t.apsCheckMaterialRequirement=o.z.array(o.z.object({materialCode:t.materialCode})).openapi({title:"srmCheckMaterialRequirement",description:"\u652f\u6301\u6279\u91cf\u83b7\u53d6\uff0c\u8986\u76d6\u96c6\u7801\u573a\u666f"}),t.oaRequestMaterialNoExceedRequirement=o.z.object({note:o.z.string().openapi({example:"todo",description:"\u5907\u6ce8"})}).openapi({title:"oaRequestMaterialNoExceedRequirement"}),t.oaNotPass=o.z.object({reason:o.z.string().openapi({example:"todo",description:"\u4e0d\u901a\u8fc7\u539f\u56e0"})}).openapi({title:"oaNotPass"}),t.sapCheckMinMax=o.z.array(o.z.object({materialCode:t.materialCode,qty:o.z.number().openapi({example:12,description:"\u7269\u6599\u6570\u91cf"})})).openapi({title:"srmCheckMinMax"}),t.sapCheckMinMaxRes=o.z.array(o.z.object({materialCode:t.materialCode,qty:o.z.number().openapi({example:12,description:"\u5f53\u524d\u5e93\u5b58\u91cf"}),max:o.z.number().openapi({example:20,description:"\u6700\u5927\u5e93\u5b58\u91cf"})})).openapi({title:"sapCheckMinMaxRes"}),t.oaRequestMaxStockApprove=o.z.object({note:o.z.string().openapi({example:"todo",description:"\u5907\u6ce8"})}).openapi({title:"oaRequestMaxStockApprove"}),t.todo=o.z.object({todo:o.z.string().openapi({example:"",description:"todo"})}).openapi({title:"todo"}),t.sapGetQualityAssurance=o.z.array(o.z.object({materialCode:t.materialCode})).openapi({title:"sapGetQualityAssurance",description:"\u652f\u6301\u6279\u91cf"}),t.getTodoPreReceiptInventoryFormRes=o.z.array(o.z.object({documentCode:o.z.string().openapi({description:"\u9884\u6536\u5355\u53f7",example:"todo"}),materialList:o.z.array(o.z.object({materialCode:t.materialCode,note:o.z.string().openapi({description:"\u8ddd\u79bb\u4e0a\u6b21\u9001\u8d276\u4e2a\u6708\u4ee5\u4e0a"})}))})).openapi({title:"getTodoPreReceiptInventoryFormRes"}),t.getQmsStatusByDocumentCodeType1Res=t.todo.openapi({description:"\u9000\u5e93",title:"getQmsStatusByDocumentCodeType1Res"}),t.getQmsStatusByDocumentCodeType2Res=t.todo.openapi({description:"\u635f\u8017",title:"getQmsStatusByDocumentCodeType2Res"}),t.getQmsStatusByDocumentCodeType3Res=t.todo.openapi({description:"\u5408\u683c",title:"getQmsStatusByDocumentCodeType3Res"}),t.getQmsStatusByDocumentCodeType4Res=t.todo.openapi({description:"\u8ba9\u6b65\u63a5\u6536",title:"getQmsStatusByDocumentCodeType4Res"}),t.getMaterialReturnRequestRes=o.z.object({documentCode:i,materialList:o.z.array(o.z.object({materialCode:t.materialCode,isPlastic:o.z.string().openapi({description:"\u662f\u5426\u662f\u5851\u80f6\u4ef6"})}))}).openapi({title:"getMaterialReturnRequestRes",description:"\u5305\u62ec\u5de5\u5355\u9000\u6599\u548c\u4e0d\u5408\u683c\u54c1\u9000\u6599"})},7335:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.productCreateManyItemSchema=t.ResetPasswordDto=t.resetPasswordWithRecoveryCodeTenantJwtSchemaDto=t.resetPasswordWithRecoveryCodeSchemaDto=t.resetPasswordWithRecoveryCodeSchema=t.GenerateRecoveryCodeDto=t.generateRecoveryCodeTenantJwtSchemaDto=t.generateRecoveryCodeSchemaDto=t.generateRecoveryCodeSchema=t.wxValidateUserTenantJwtPayloadSchemaDto=t.wxValidateUserSchema=t.wxGetUserRes=t.wxGetAccessTokenRes=t.customerSignupTenantJwtPayloadSchemaDto=t.customerSignupSchemaDto=t.customerSignupSchema=t.customerPreSignupTenantJwtPayloadSchemaDto=t.customerPreSignupSchemaDto=t.customerPreSignupSchema=t.userJwtPayloadSchemaDto=t.userJwtPayloadSchema=t.tenantJwtPayloadSchema=t.verifyMobileSchemaDto=t.verifyMobileSchema=t.resetPasswordSchemaDto=t._resetPasswordSchema=t.resetPasswordSchema=t.RegisterByUnionIdSchemaDto=t.registerByUnionIdSchema=t.FindByUnionIdAndTenantIdSchemaDto=t.findByUnionIdAndTenantIdSchema=t.GetTenantByNameSchemaDto=t.getTenantByNameSchema=t.validateSchemaDto=t.validateSchema=t.AccountExistsSchemaDto=t.accountExistsSchema=t.RegisterDto=t.registerSchema=t.prismaFilterSchema=t.agSortSchema=t.agFilterSchema=t.agFilter2Schema=t.agFilter1Schema=t.agFilterInner2Schema=t.agFilterInnerSchema=t.resourceSchema=t.resourceColumnSchema=t.resourceAssociationSchema=t.selectOptionSchema=void 0,t.StartSchemaDto=t.deploySiteToCosSchemaDto=t.deploySiteToCosSchema=t.menuItemSchemaDto=t.menuItemSchema=t.baseMenuItemSchema=t.getMenuSchemaDto=t.getMenuSchema=t.getMenuByTenantNameSchemaDto=t.getMenuByTenantNameSchema=t.loginSchemaDto=t.loginSchema=t.refreshTokenSchemaDto=t.refreshTokenSchema=t.sendSmsVerifyCodeSchemaDto=t.sendSmsVerifyCodeSchema=t.kanzhunDataSchema=t.kanzhunItemSchemaDto=t.kanzhunItemSchema=t.kanzhunDetailSchemaDto=t.kanzhunDetailSchema=t.customerExtendDataSchemaDto=t.customerExtendDataSchema=t._resetTenantPasswordSchemaDto=t._resetTenantPasswordSchema=t.validateByEmailSchemaDto=t.validateByEmailSchema=t.validateTenantSchemaDto=t.validateTenantSchema=t.appCreateV4SchemaDto=t.appCreateV4Schema=t.createQuickOrderTenantJWTPayloadSchemaDto=t.SdkCreateQuickOrderDto=t.createQuickOrderSchema=t.SdkCreateOrderInJSAPIDto=t.createOrderJSAPISchema=t.transactionsNativeSchemaDto=t.transactionsNativeSchema=t.createOrderUserJwtPayloadSchemaDto=t.SdkCreateOrderDto=t.createOrderSchema=t.amountUpdateUserJwtPayloadSchemaDto=t.amountUpdateSchemaDto=t.amountUpdateSchema=t.fwhLoginTenantJwtPayloadSchemaDto=t.fwhLoginSchema=t.wxPayQuerySchema=t.updateFreeProfileSchema=t.updatePaidProfileSchema=t.SdkProductCreateManyItemDto=void 0,t.getTasksSchema=t.GetTaskFormSchemaDto=void 0;const r=a(1569),o=a(128);(0,a(7967).extendZod)(r.z),t.selectOptionSchema=r.z.object({value:r.z.union([r.z.string(),r.z.number()]),label:r.z.string()}),t.resourceAssociationSchema=r.z.object({foreign_key:r.z.string(),model_name:r.z.string(),primary_key:r.z.string(),name:r.z.string(),slug:r.z.string(),display_name:r.z.string(),schema_name:r.z.string()}),t.resourceColumnSchema=r.z.object({name:r.z.string(),access_type:r.z.enum(["read_only"]).optional(),column_type:r.z.enum(["reference","string","tag","integer","datetime","textarea","boolean"]),prisma:r.z.boolean().optional(),format:r.z.object({select_options:t.selectOptionSchema.array()}).optional(),reference:r.z.object({model_name:r.z.string(),primary_key:r.z.string(),display_name:r.z.string(),display_column:r.z.union([r.z.string(),r.z.array(r.z.string()),r.z.undefined()]),"x-relationField":r.z.string(),"x-onSoftDelete":r.z.string(),"x-unique":r.z.boolean().optional()}),display_name:r.z.string().optional(),validators:r.z.array(r.z.union([r.z.object({required:r.z.boolean()}),r.z.object({format:r.z.string(),message:r.z.string()})]))}),t.resourceSchema=r.z.object({namespace:r.z.string().optional(),prisma:r.z.boolean().optional(),is_dynamic:r.z.boolean().optional(),schema_name:r.z.string(),name:r.z.string(),slug:r.z.string(),primary_key:r.z.string(),"x-legacy":r.z.any(),display_column:r.z.union([r.z.string(),r.z.array(r.z.string()),r.z.undefined()]),display_name:r.z.string().nullable(),display_primary_key:r.z.boolean(),searchable_columns:r.z.array(r.z.string()).optional(),columns:t.resourceColumnSchema.array(),associations:t.resourceAssociationSchema.array(),__jsonschema:r.z.any()}),t.agFilterInnerSchema=r.z.object({filterType:r.z.enum(["text","number"]),type:r.z.enum(["contains","equals"]),filter:r.z.union([r.z.string(),r.z.number()])}),t.agFilterInner2Schema=r.z.object({filterType:r.z.enum(["text"]),operator:r.z.enum(["OR","AND"]),conditions:r.z.array(t.agFilterInnerSchema)}),t.agFilter1Schema=r.z.record(t.agFilterInnerSchema),t.agFilter2Schema=r.z.record(t.agFilterInner2Schema),t.agFilterSchema=r.z.record(t.agFilterInnerSchema.or(t.agFilterInner2Schema)).or(r.z.object({_ref:r.z.string().optional()})),t.agSortSchema=r.z.array(r.z.object({colId:r.z.string(),sort:r.z.enum(["asc","desc"])})),t.prismaFilterSchema=r.z.object({OR:r.z.array(r.z.record(r.z.record(r.z.enum(["contains"]),r.z.string())))}),t.registerSchema=r.z.object({username:r.z.string(),password:r.z.string(),tenantId:r.z.number()});class RegisterDto extends((0,o.createZodDto)(t.registerSchema)){}t.RegisterDto=RegisterDto,t.accountExistsSchema=r.z.object({username:r.z.string(),tenantName:r.z.string()});class AccountExistsSchemaDto extends((0,o.createZodDto)(t.accountExistsSchema)){}t.AccountExistsSchemaDto=AccountExistsSchemaDto,t.validateSchema=r.z.object({tenantId:r.z.number().optional(),username:r.z.string(),password:r.z.string()});class validateSchemaDto extends((0,o.createZodDto)(t.validateSchema)){}t.validateSchemaDto=validateSchemaDto,t.getTenantByNameSchema=r.z.object({tenantName:r.z.string()});class GetTenantByNameSchemaDto extends((0,o.createZodDto)(t.getTenantByNameSchema)){}t.GetTenantByNameSchemaDto=GetTenantByNameSchemaDto,t.findByUnionIdAndTenantIdSchema=r.z.object({unionid:r.z.string(),tenantId:r.z.number()});class FindByUnionIdAndTenantIdSchemaDto extends((0,o.createZodDto)(t.findByUnionIdAndTenantIdSchema)){}t.FindByUnionIdAndTenantIdSchemaDto=FindByUnionIdAndTenantIdSchemaDto,t.registerByUnionIdSchema=r.z.object({unionid:r.z.string(),tenantId:r.z.number()});class RegisterByUnionIdSchemaDto extends((0,o.createZodDto)(t.registerByUnionIdSchema)){}t.RegisterByUnionIdSchemaDto=RegisterByUnionIdSchemaDto,t.resetPasswordSchema=r.z.object({userId:r.z.number(),tenantId:r.z.number(),password:r.z.string()}),t._resetPasswordSchema=t.resetPasswordSchema.extend({tid:r.z.number()});class resetPasswordSchemaDto extends((0,o.createZodDto)(t.resetPasswordSchema)){}t.resetPasswordSchemaDto=resetPasswordSchemaDto,t.verifyMobileSchema=r.z.object({uid:r.z.number(),tid:r.z.number(),mobile:r.z.string(),code:r.z.string(),slug:r.z.string()});class verifyMobileSchemaDto extends((0,o.createZodDto)(t.verifyMobileSchema)){}t.verifyMobileSchemaDto=verifyMobileSchemaDto,t.tenantJwtPayloadSchema=r.z.object({tid:r.z.number()}),t.userJwtPayloadSchema=r.z.object({uid:r.z.number(),tid:r.z.number()});class userJwtPayloadSchemaDto extends((0,o.createZodDto)(t.userJwtPayloadSchema)){}t.userJwtPayloadSchemaDto=userJwtPayloadSchemaDto,t.customerPreSignupSchema=r.z.object({email:r.z.string()});class customerPreSignupSchemaDto extends((0,o.createZodDto)(t.customerPreSignupSchema)){}t.customerPreSignupSchemaDto=customerPreSignupSchemaDto;class customerPreSignupTenantJwtPayloadSchemaDto extends((0,o.createZodDto)(t.customerPreSignupSchema.merge(t.tenantJwtPayloadSchema))){}t.customerPreSignupTenantJwtPayloadSchemaDto=customerPreSignupTenantJwtPayloadSchemaDto,t.customerSignupSchema=r.z.object({email:r.z.string(),verifyCode:r.z.string(),password:r.z.string()});class customerSignupSchemaDto extends((0,o.createZodDto)(t.customerSignupSchema)){}t.customerSignupSchemaDto=customerSignupSchemaDto;class customerSignupTenantJwtPayloadSchemaDto extends((0,o.createZodDto)(t.customerSignupSchema.merge(t.tenantJwtPayloadSchema))){}t.customerSignupTenantJwtPayloadSchemaDto=customerSignupTenantJwtPayloadSchemaDto,t.wxGetAccessTokenRes=r.z.object({access_token:r.z.string(),expires_in:r.z.string(),refresh_token:r.z.string(),openid:r.z.string(),scope:r.z.string(),unionid:r.z.string(),create_at:r.z.string()}),t.wxGetUserRes=r.z.object({openid:r.z.string(),nickname:r.z.string(),sex:r.z.number(),headimgurl:r.z.string(),unionid:r.z.string(),language:r.z.string(),city:r.z.string(),province:r.z.string(),country:r.z.string(),privilege:r.z.array(r.z.string())}),t.wxValidateUserSchema=r.z.object({code:r.z.string()});class wxValidateUserTenantJwtPayloadSchemaDto extends((0,o.createZodDto)(t.wxValidateUserSchema.merge(t.tenantJwtPayloadSchema))){}t.wxValidateUserTenantJwtPayloadSchemaDto=wxValidateUserTenantJwtPayloadSchemaDto,t.generateRecoveryCodeSchema=r.z.object({email:r.z.string()});class generateRecoveryCodeSchemaDto extends((0,o.createZodDto)(t.generateRecoveryCodeSchema)){}t.generateRecoveryCodeSchemaDto=generateRecoveryCodeSchemaDto;class generateRecoveryCodeTenantJwtSchemaDto extends((0,o.createZodDto)(t.generateRecoveryCodeSchema.merge(t.tenantJwtPayloadSchema))){}t.generateRecoveryCodeTenantJwtSchemaDto=generateRecoveryCodeTenantJwtSchemaDto;class GenerateRecoveryCodeDto extends((0,o.createZodDto)(t.generateRecoveryCodeSchema.merge(r.z.object({appId:r.z.string()})))){}t.GenerateRecoveryCodeDto=GenerateRecoveryCodeDto,t.resetPasswordWithRecoveryCodeSchema=r.z.object({recoveryCode:r.z.string(),password:r.z.string()});class resetPasswordWithRecoveryCodeSchemaDto extends((0,o.createZodDto)(t.resetPasswordWithRecoveryCodeSchema)){}t.resetPasswordWithRecoveryCodeSchemaDto=resetPasswordWithRecoveryCodeSchemaDto;class resetPasswordWithRecoveryCodeTenantJwtSchemaDto extends((0,o.createZodDto)(t.resetPasswordWithRecoveryCodeSchema.merge(t.tenantJwtPayloadSchema))){}t.resetPasswordWithRecoveryCodeTenantJwtSchemaDto=resetPasswordWithRecoveryCodeTenantJwtSchemaDto;class ResetPasswordDto extends((0,o.createZodDto)(t.resetPasswordWithRecoveryCodeSchema.merge(r.z.object({appId:r.z.string()})))){}t.ResetPasswordDto=ResetPasswordDto,t.productCreateManyItemSchema=r.z.object({name:r.z.string(),price:r.z.number(),productType:r.z.string(),amount:r.z.number().optional(),plan:r.z.number().nullable().optional(),extendedDescriptionData:r.z.any().optional(),restricted:r.z.number().nullable().optional(),fileSize:r.z.string().nullable().optional(),storeDuration:r.z.number().nullable().optional(),hasAds:r.z.string().nullable().optional(),tecSupport:r.z.string().nullable().optional()});class SdkProductCreateManyItemDto extends((0,o.createZodDto)(t.productCreateManyItemSchema)){}t.SdkProductCreateManyItemDto=SdkProductCreateManyItemDto,t.updatePaidProfileSchema=r.z.object({product:r.z.object({productType:r.z.any(),plan:r.z.number().nullable(),amount:r.z.number().nullable(),validityPeriod:r.z.number().nullable()})}),t.updateFreeProfileSchema=r.z.object({product:r.z.object({productType:r.z.any(),plan:r.z.number().nullable(),amount:r.z.number().nullable(),validityPeriod:r.z.number().nullable()})}),t.wxPayQuerySchema=r.z.object({status:r.z.number(),trade_state:r.z.string(),transaction_id:r.z.string(),payer:r.z.object({openid:r.z.string()})}),t.fwhLoginSchema=r.z.object({code:r.z.string()});class fwhLoginTenantJwtPayloadSchemaDto extends((0,o.createZodDto)(t.fwhLoginSchema.merge(t.tenantJwtPayloadSchema))){}t.fwhLoginTenantJwtPayloadSchemaDto=fwhLoginTenantJwtPayloadSchemaDto,t.amountUpdateSchema=r.z.object({action:r.z.enum(["decrement"]).optional(),count:r.z.number().optional()});class amountUpdateSchemaDto extends((0,o.createZodDto)(t.amountUpdateSchema)){}t.amountUpdateSchemaDto=amountUpdateSchemaDto;class amountUpdateUserJwtPayloadSchemaDto extends((0,o.createZodDto)(t.amountUpdateSchema.merge(t.userJwtPayloadSchema))){}t.amountUpdateUserJwtPayloadSchemaDto=amountUpdateUserJwtPayloadSchemaDto,t.createOrderSchema=r.z.object({productId:r.z.string(),openid:r.z.string().optional()});class SdkCreateOrderDto extends((0,o.createZodDto)(t.createOrderSchema)){}t.SdkCreateOrderDto=SdkCreateOrderDto;class createOrderUserJwtPayloadSchemaDto extends((0,o.createZodDto)(t.createOrderSchema.merge(t.userJwtPayloadSchema))){}t.createOrderUserJwtPayloadSchemaDto=createOrderUserJwtPayloadSchemaDto,t.transactionsNativeSchema=r.z.object({orderId:r.z.string(),desc:r.z.string(),total:r.z.number(),openid:r.z.string().optional()});class transactionsNativeSchemaDto extends((0,o.createZodDto)(t.transactionsNativeSchema)){}t.transactionsNativeSchemaDto=transactionsNativeSchemaDto,t.createOrderJSAPISchema=t.createOrderSchema.extend({openid:r.z.string()});class SdkCreateOrderInJSAPIDto extends((0,o.createZodDto)(t.createOrderJSAPISchema)){}t.SdkCreateOrderInJSAPIDto=SdkCreateOrderInJSAPIDto,t.createQuickOrderSchema=t.createOrderSchema.extend({anonymousCustomerToken:r.z.string()});class SdkCreateQuickOrderDto extends((0,o.createZodDto)(t.createQuickOrderSchema)){}t.SdkCreateQuickOrderDto=SdkCreateQuickOrderDto;class createQuickOrderTenantJWTPayloadSchemaDto extends((0,o.createZodDto)(t.createQuickOrderSchema.merge(t.tenantJwtPayloadSchema))){}t.createQuickOrderTenantJWTPayloadSchemaDto=createQuickOrderTenantJWTPayloadSchemaDto,t.appCreateV4Schema=r.z.object({displayName:r.z.string()});class appCreateV4SchemaDto extends((0,o.createZodDto)(t.appCreateV4Schema)){}t.appCreateV4SchemaDto=appCreateV4SchemaDto,t.validateTenantSchema=r.z.object({name:r.z.string(),password:r.z.string()});class validateTenantSchemaDto extends((0,o.createZodDto)(t.validateTenantSchema)){}t.validateTenantSchemaDto=validateTenantSchemaDto,t.validateByEmailSchema=r.z.object({email:r.z.string(),tenantId:r.z.number(),password:r.z.string()});class validateByEmailSchemaDto extends((0,o.createZodDto)(t.validateByEmailSchema)){}t.validateByEmailSchemaDto=validateByEmailSchemaDto,t._resetTenantPasswordSchema=r.z.object({id:r.z.number()});class _resetTenantPasswordSchemaDto extends((0,o.createZodDto)(t._resetTenantPasswordSchema)){}t._resetTenantPasswordSchemaDto=_resetTenantPasswordSchemaDto,t.customerExtendDataSchema=r.z.object({biz:r.z.string(),icp:r.z.string().nullable(),contact:r.z.object({email:r.z.string(),phone:r.z.string(),address:r.z.string()}).partial(),companyName:r.z.string(),description:r.z.string()}).partial();class customerExtendDataSchemaDto extends((0,o.createZodDto)(t.customerExtendDataSchema)){}t.customerExtendDataSchemaDto=customerExtendDataSchemaDto,t.kanzhunDetailSchema=r.z.object({"\u516c\u53f8\u5168\u79f0":r.z.string(),"\u8054\u7cfb\u65b9\u5f0f":r.z.array(r.z.string()),"\u5730\u5740":r.z.string(),"\u7b80\u4ecb":r.z.string()}).partial();class kanzhunDetailSchemaDto extends((0,o.createZodDto)(t.kanzhunDetailSchema)){}t.kanzhunDetailSchemaDto=kanzhunDetailSchemaDto,t.kanzhunItemSchema=r.z.object({id:r.z.number(),name:r.z.string(),detail:t.kanzhunDetailSchema}).partial();class kanzhunItemSchemaDto extends((0,o.createZodDto)(t.kanzhunItemSchema)){}t.kanzhunItemSchemaDto=kanzhunItemSchemaDto,t.kanzhunDataSchema=r.z.object({date:r.z.string(),data:r.z.array(t.kanzhunItemSchema)}).partial(),t.sendSmsVerifyCodeSchema=r.z.object({mobile:r.z.string()});class sendSmsVerifyCodeSchemaDto extends((0,o.createZodDto)(t.sendSmsVerifyCodeSchema)){}t.sendSmsVerifyCodeSchemaDto=sendSmsVerifyCodeSchemaDto,t.refreshTokenSchema=r.z.object({rt:r.z.string()});class refreshTokenSchemaDto extends((0,o.createZodDto)(t.refreshTokenSchema)){}t.refreshTokenSchemaDto=refreshTokenSchemaDto,t.loginSchema=r.z.object({username:r.z.string(),password:r.z.string().min(4)});class loginSchemaDto extends((0,o.createZodDto)(t.loginSchema)){}t.loginSchemaDto=loginSchemaDto,t.getMenuByTenantNameSchema=r.z.object({tenantName:r.z.string()});class getMenuByTenantNameSchemaDto extends((0,o.createZodDto)(t.getMenuByTenantNameSchema)){}t.getMenuByTenantNameSchemaDto=getMenuByTenantNameSchemaDto,t.getMenuSchema=r.z.object({tenantId:r.z.number()});class getMenuSchemaDto extends((0,o.createZodDto)(t.getMenuSchema)){}t.getMenuSchemaDto=getMenuSchemaDto,t.baseMenuItemSchema=r.z.object({name:r.z.string(),slug:r.z.string(),id:r.z.string()}),t.menuItemSchema=t.baseMenuItemSchema.extend({children:r.z.lazy((()=>t.menuItemSchema.array().optional()))});class menuItemSchemaDto extends((0,o.createZodDto)(t.menuItemSchema)){}t.menuItemSchemaDto=menuItemSchemaDto,t.deploySiteToCosSchema=r.z.object({siteId:r.z.number()});class deploySiteToCosSchemaDto extends((0,o.createZodDto)(t.deploySiteToCosSchema)){}t.deploySiteToCosSchemaDto=deploySiteToCosSchemaDto;const i=r.z.object({tenantId:r.z.string(),processDefKey:r.z.string(),businessKey:r.z.union([r.z.number(),r.z.string()])});class StartSchemaDto extends((0,o.createZodDto)(i)){}t.StartSchemaDto=StartSchemaDto;const n=r.z.object({taskId:r.z.string()});class GetTaskFormSchemaDto extends((0,o.createZodDto)(n)){}t.GetTaskFormSchemaDto=GetTaskFormSchemaDto,t.getTasksSchema=r.z.object({tenantIdIn:r.z.array(r.z.string())})},8021:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.flowdaSharedModule=void 0;const r=a(5337),o=a(6185),i=a(9780),n=a(694),s=a(2487),c=a(7578),d=a(2181),m=a(7967),l=a(3719),u=a(8736);t.flowdaSharedModule=new r.ContainerModule((e=>{(0,m.bindServiceSymbol)(e,o.DataServiceSymbol,n.DataService),(0,m.bindServiceSymbol)(e,o.LegacySchemaServiceSymbol,s.LegacySchemaService),e(o.SchemaServiceSymbol).to(u.SchemaService).inSingletonScope(),e(o.PrismaSchemaServiceSymbol).to(i.PrismaSchemaService).inSingletonScope(),e(o.PrismaUtilsSymbol).to(d.PrismaUtils).inSingletonScope(),e(o.SchemaTransformerSymbol).to(c.SchemaTransformer).inTransientScope(),e("Factory<SchemaTransformer>").toFactory((e=>t=>{const a=e.container.get(o.SchemaTransformerSymbol);return a.setZodType(t),a})),e(o.DynamicTableSchemaTransformerSymbol).to(l.DynamicTableSchemaTransformer).inTransientScope()}))},2409:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SchemaServiceSymbol=t.DataServiceSymbol=void 0;const r=a(5584);var o=a(6185);Object.defineProperty(t,"DataServiceSymbol",{enumerable:!0,get:function(){return o.DataServiceSymbol}}),Object.defineProperty(t,"SchemaServiceSymbol",{enumerable:!0,get:function(){return o.SchemaServiceSymbol}}),r.__exportStar(a(8021),t),r.__exportStar(a(7253),t),r.__exportStar(a(7492),t),r.__exportStar(a(744),t),r.__exportStar(a(5316),t),r.__exportStar(a(8243),t),r.__exportStar(a(2818),t),r.__exportStar(a(4931),t),r.__exportStar(a(7578),t),r.__exportStar(a(3719),t),r.__exportStar(a(2487),t),r.__exportStar(a(8736),t),r.__exportStar(a(694),t)},694:(e,t,a)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.DataService=void 0;const o=a(5584),i=a(5337),n=o.__importStar(a(6557)),s=a(7825),c=a(3169),d=a(6185);let m=r=class DataService{constructor(e,t,a){this.prisma=e,this.prismaSchemaService=t,this.logger=a(r.name)}get(e,t,a){return o.__awaiter(this,void 0,void 0,(function*(){this.logger.log(`get(reqUser ${JSON.stringify(e)}, path: ${t}, query: ${JSON.stringify(a)})`);const r=yield this.prismaSchemaService.toFindParam(t,a);if(n.isEmpty(r))return{};const{resource:o,action:i,param:s}=r;if("findUnique"===i){const e=yield this.prisma[o][i](s);return!e||e.isDeleted?{}:n.omit(e,["isDeleted"])}if("findMany"===i){const[e,t]=yield this.prisma.$transaction([this.prisma[o][i](s),this.prisma[o].count({where:s.where})]);return{pagination:{total:t},data:e}}}))}put(e,t,a){return o.__awaiter(this,void 0,void 0,(function*(){this.logger.log(`put(reqUser ${JSON.stringify(e)}), path: ${t}, values: ${JSON.stringify(a)}`);const r=yield this.prismaSchemaService.toUpdateParam(t,a),{resource:o,param:i}=r,s=yield this.prisma[o].findUnique({where:{id:i.where.id},select:n.mapValues(i.data,(e=>!0))}),c=Object.keys(i.data).reduce(((e,t)=>(e[t]=[s[t],i.data[t]],e)),{}),d=yield this.prisma[o].update(i),m={auditId:i.where.id,auditType:o,userId:JSON.stringify(e.user_id||e.uid),username:e.user_name,action:"update",auditChanges:JSON.stringify(c),version:0};this.logger.debug(`audit ${JSON.stringify(m)}`);try{yield this.prisma.audits.create({data:m})}catch(l){this.logger.warn(`audit create failed, ${JSON.stringify(m)}`)}return d}))}post(e,t,a){return o.__awaiter(this,void 0,void 0,(function*(){this.logger.log(`[post] reqUser ${JSON.stringify(e)}, path: ${t}, query: ${JSON.stringify(a)})`);const r=yield this.prismaSchemaService.toCreateParam(t,a),{resource:o,param:i}=r;if(r["x-unique"]){const t=r["x-unique"],c=a[t.name],d=t.reference.model_name,m=(yield this.prisma[(0,s.lowerFirst)(d)].findUnique({where:{id:c},include:{[o]:!0}}))[o].id,l=yield this.prisma[o].update({where:{id:m},data:Object.assign(Object.assign({},i.data),{isDeleted:!1})}),u={auditId:m,auditType:o,userId:JSON.stringify(e.user_id||e.uid),username:e.user_name,action:"soft_delete_revert",auditChanges:JSON.stringify(i.data),version:0};this.logger.debug(`audit ${JSON.stringify(u)}`);try{yield this.prisma.audits.create({data:u})}catch(n){this.logger.warn(`audit create failed, ${JSON.stringify(u)}`)}return l}{const t=yield this.prisma[o].create(i),a={auditId:t.id,auditType:o,userId:JSON.stringify(e.user_id||e.uid),username:e.user_name,action:"create",auditChanges:JSON.stringify(i.data),version:0};this.logger.debug(`audit ${JSON.stringify(a)}`);try{yield this.prisma.audits.create({data:a})}catch(n){this.logger.warn(`audit create failed, ${JSON.stringify(a)}`)}return t}}))}remove(e,t){return o.__awaiter(this,void 0,void 0,(function*(){this.logger.log(`[remove] reqUser ${JSON.stringify(e)}, path: ${t}`);const a=yield this.prismaSchemaService.getAssociationDeleteStrategy(t),{resource:r,param:o}=yield this.prismaSchemaService.toRemoveParam(t);for(const e of Object.keys(a)){const t=a[e];if("Restrict"===t["x-onSoftDelete"]){if((yield this.prisma[(0,s.lowerFirst)(e)].findMany({where:{isDeleted:!1,[t.name]:o.where.id}})).length>0)throw new Error(`\u5220\u9664\u5931\u8d25, \u5173\u8054\u7684<${t.relatedDisplayName}>\u4e0d\u4e3a\u7a7a`)}}const i=yield this.prisma[r].findUnique({where:{id:o.where.id}}),n=yield this.prisma[r].update(o),c={auditId:o.where.id,auditType:r,userId:JSON.stringify(e.user_id||e.uid),username:e.user_name,action:"soft_delete",auditChanges:JSON.stringify(i),version:0};this.logger.debug(`audit ${JSON.stringify(c)}`);try{yield this.prisma.audits.create({data:c})}catch(d){this.logger.warn(`audit create failed, ${JSON.stringify(c)}`)}return n}))}};t.DataService=m,t.DataService=m=r=o.__decorate([(0,i.injectable)(),o.__param(0,(0,i.inject)(c.PrismaClientSymbol)),o.__param(1,(0,i.inject)(d.PrismaSchemaServiceSymbol)),o.__param(2,(0,i.inject)("Factory<Logger>")),o.__metadata("design:paramtypes",[Object,Object,Function])],m)},3719:(e,t,a)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.DynamicTableSchemaTransformer=void 0;const o=a(5584),i=a(5337),n=a(7253);let s=r=class DynamicTableSchemaTransformer{constructor(e){this.logger=e(r.name)}transform(e){const t=e.dynamicTableDefColumns.map((e=>Object.assign({name:e.name,column_type:e.type},e.extendedSchema)));return Object.assign({name:(0,n.toModelName)(e.name),slug:(0,n.toPath)(e.name),schema_name:(0,n.toSchemaName)(e.name),primary_key:"id",columns:t,prisma:!1,is_dynamic:!0},e.extendedSchema)}};t.DynamicTableSchemaTransformer=s,t.DynamicTableSchemaTransformer=s=r=o.__decorate([(0,i.injectable)(),o.__param(0,(0,i.inject)("Factory<Logger>")),o.__metadata("design:paramtypes",[Function])],s)},2487:(e,t,a)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.LegacySchemaService=void 0;const o=a(5584),i=a(5337),n=a(3169);let s=r=class LegacySchemaService{constructor(e,t,a){this.modelSchemaFactory=t,this.czt=a,this.logger=e(r.name)}getSchema(){console.time("generate schema");const e=Object.keys(this.czt).reduce(((e,t)=>{const a=this.czt[t];if(["ZodObject"].indexOf(a.constructor.name)>-1){const r=this.modelSchemaFactory(a);e[t]=r.buildSchema().toSchema(t)}else this.logger.error("Wrong type",t);return e}),{});return this.schemaCache=e,console.timeEnd("generate schema"),e}getSchemaCache(){return o.__awaiter(this,void 0,void 0,(function*(){return this.schemaCache?this.schemaCache:(this.logger.log("schemaCache is empty, getSchema again."),this.getSchema())}))}};t.LegacySchemaService=s,t.LegacySchemaService=s=r=o.__decorate([(0,i.injectable)(),o.__param(0,(0,i.inject)("Factory<Logger>")),o.__param(1,(0,i.inject)("Factory<SchemaTransformer>")),o.__param(2,(0,i.inject)(n.CustomZodSchemaSymbol)),o.__metadata("design:paramtypes",[Function,Function,Object])],s)},4931:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.meta=void 0;const r=a(1569);t.meta=function(e){return r.z.unknown().optional().describe(JSON.stringify(e))}},9780:(e,t,a)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.PrismaSchemaService=void 0;const o=a(5584),i=a(5337),n=a(7253),s=a(7825),c=o.__importStar(a(6557)),d=a(6185);let m=r=class PrismaSchemaService{constructor(e,t,a){this.prismaUtils=e,this.schemaService=t,this.logger=a(r.name)}toPrismaSelect(e,t){let a=[];return a=null==e?t.columns.filter((e=>(null==e?void 0:e["x-legacy"])?!1!==e["x-legacy"].prisma:!1!==e.prisma)).map((e=>e.name)):e.split(","),a.reduce(((e,t)=>(e[t]=!0,e)),{})}toFindParam(e,t){return o.__awaiter(this,void 0,void 0,(function*(){this.logger.debug(`[toFindParam] pathname: ${e}, query: ${JSON.stringify(t)}`);const a=(0,n.matchPath)(e);if(0===a.length)return Promise.resolve({});const r=a[a.length-1],o=a[a.length-2];let i=r.resource,d=r.resourceSchema;const m=yield this.schemaService.getSchemaCache();if(o){const e=m[o.resourceSchema].associations.find((e=>e.slug===r.origin));e&&(d=null==e?void 0:e.schema_name,i=c.camel(e.model_name))}const l=m[d];let u,p={};const h=t.fields,S=this.toPrismaSelect(h&&h[i],l),g={};if("string"==typeof t.include&&""!==t.include&&t.include.split(",").forEach((e=>{const t=this.getRefSelect(m,l,e),a=this.toPrismaSelect(h[e],l);g[e]={select:Object.assign(Object.assign({},a),t)}})),null!=r.id){u="findUnique";p={where:{id:yield this.prismaUtils.parseId(i,r.id)},select:Object.assign(Object.assign(Object.assign({},S),g),{isDeleted:!0})}}else{const e=this.convertQueryToPrismaFilter(m,l,t),r=this.convertToOrderBy(t);u="findMany";const o=t.current?(Number(t.current)-1)*Number(t.pageSize):void 0,i=t.pageSize?Number(t.pageSize):void 0;if(a.length>1){const t=a[a.length-2];p=(0,s.omitBy)({where:Object.assign({[`${t.resource}Id`]:t.id,isDeleted:!1},e),orderBy:r,skip:o,take:i,select:Object.assign(Object.assign({},S),g)},s.isUndefined)}else p=(0,s.omitBy)({where:Object.assign({isDeleted:!1},e),orderBy:r,skip:o,take:i,select:Object.assign(Object.assign({},S),g)},s.isUndefined)}const y={action:u,param:p,resource:i};return this.logger.debug(`[toFindParam] ret ${JSON.stringify(y)}`),y}))}convertToOrderBy(e){let t;return null==e.sort?[{createdAt:"desc"}]:(t=e.sort,"-"===t[0]?[{[t.slice(1)]:"desc"}]:[{[t]:"asc"}])}getRefSelect(e,t,a){const r={};if(t&&t.columns){const o=t.columns.find((e=>"reference"===e.column_type&&e.reference["x-relationField"]===a));if(o){const{model_name:t,display_column:a}=o.reference,i=e[t+"ResourceSchema"];let n=[];n="string"==typeof a?[a]:a||[],n.forEach((e=>{const a=i.columns.find((t=>t.name===e));if(null==a)throw new Error(`schema '${t}', wrong display column '${e}'`);if("reference"===a.column_type){const e=a.reference.display_column,t=a.reference["x-relationField"];let o;o=Array.isArray(e)?e:[e];const i=o.reduce(((e,t)=>(e[t]=!0,e)),{});r[t]={select:Object.assign({id:!0},i)}}}))}}return r}convertQueryToPrismaFilter(e,t,a){if(a.filterModel)return this.convertAgFilterModelToPrismaFilter(a.filterModel);if(a.filter&&Array.isArray(a.filter)&&a.filter.length>0){const r=a.filter,o=r.findIndex((e=>"string"==typeof e&&"AND"===e)),i=r.findIndex((e=>"string"==typeof e&&"OR"===e)),n={};if(0===o)if(n.AND=[],-1===i){r.slice(1).forEach((a=>n.AND.push(this.mapItemToPrismaFilter(e,t,a))))}else{r.slice(1,i).forEach((a=>n.AND.push(this.mapItemToPrismaFilter(e,t,a)))),n.OR=[];r.slice(i+1).forEach((a=>n.OR.push(this.mapItemToPrismaFilter(e,t,a))))}else{if(0!==i)throw new Error("Wrong filter");if(n.OR=[],-1===o){r.slice(1).forEach((a=>n.OR.push(this.mapItemToPrismaFilter(e,t,a))))}else{r.slice(1,o).forEach((a=>n.OR.push(this.mapItemToPrismaFilter(e,t,a)))),n.AND=[];r.slice(o+1).forEach((a=>n.AND.push(this.mapItemToPrismaFilter(e,t,a))))}}return n}return null!=a.q&&Array.isArray(t.searchable_columns)&&t.searchable_columns.length>0?{OR:t.searchable_columns.reduce(((e,t)=>(e.push({[t]:{contains:a.q}}),e)),[])}:{}}convertAgFilterModelToPrismaFilter(e){const t=d.agFilter1Schema.safeParse(e);if(t.success)return c.mapValues(t.data,((e,t)=>({[e.type]:e.filter})));{const t=d.agFilter2Schema.safeParse(e);if(t.success){const e={};for(const a of Object.keys(t.data)){const r=t.data[a];if("OR"===r.operator){null==e.OR&&(e.OR=[]);for(const t of r.conditions)e.OR.push({[a]:{[t.type]:t.filter}})}}return e}return{}}}toUpdateParam(e,t){return o.__awaiter(this,void 0,void 0,(function*(){this.logger.debug(`pathname: ${e}, body: ${JSON.stringify(t)}`);const a=(0,n.matchPath)(e),{resource:r,id:o,resourceSchema:i}=a[a.length-1],s=yield this.schemaService.getSchemaCache();this.removeRelationFields(s,i,t);const c={resource:r,param:{where:{id:o},data:t}};return this.logger.debug(JSON.stringify(c)),c}))}getAssociationDeleteStrategy(e){return o.__awaiter(this,void 0,void 0,(function*(){const t=(0,n.matchPath)(e),{origin:a,resourceSchema:r}=t[t.length-1],o=yield this.schemaService.getSchemaCache(),i=o[r];if(null==i.associations)return{};return i.associations.reduce(((e,t)=>{const i=o[t.model_name+"ResourceSchema"];if(null==i)throw new Error(`${r} associated schema ${t.model_name} is null`);const s=i.columns.find((e=>"reference"===e.column_type&&e.reference.model_name===(0,n.toModelName)(a)));if(null==s)throw new Error("Cannot found related column");return"Restrict"===s.reference["x-onSoftDelete"]?(e[t.model_name]={"x-onSoftDelete":s.reference["x-onSoftDelete"],name:s.name,relatedDisplayName:i.display_name},e):e}),{})}))}toRemoveParam(e){return o.__awaiter(this,void 0,void 0,(function*(){const t=(0,n.matchPath)(e),{resource:a,origin:r,id:o,resourceSchema:i}=t[t.length-1],s=yield this.schemaService.getSchemaCache(),c=s[i];let d,m,l={};if(null!=c.associations&&(l=c.associations.reduce(((e,t)=>{const a=s[t.model_name+"ResourceSchema"].columns.find((e=>"reference"===e.column_type&&e.reference.model_name===(0,n.toModelName)(r)));if(null==a)throw new Error("Cannot found related column");return"Restrict"!==a.reference["x-onSoftDelete"]&&(e[t.name]={set:[]},null==d&&(d={}),d[t.name]=!0),e}),{})),null==o)throw new Error(`remove ${a}, id null`);m=yield this.prismaUtils.parseId(a,o);const u={resource:a,param:{where:{id:m},data:Object.assign({isDeleted:!0},l),include:d}};return this.logger.debug(JSON.stringify(u)),u}))}mapItemToPrismaFilter(e,t,a){const r=Object.keys(a)[0];a[r]=c.mapKeys(a[r],((e,t)=>{switch(e){case"eq":return"equals";case"neq":return"not";default:return e}})),a[r]=c.mapValues(a[r],(a=>{const o=r.split(".");let i;if(2===o.length){const a=t.columns.find((e=>"reference"===e.column_type&&e.reference["x-relationField"]===o[0]));i=e[a.reference.model_name+"ResourceSchema"].columns.find((e=>e.name===o[1]))}else i=t.columns.find((e=>e.name===r));return i&&["string","textarea"].indexOf(i.column_type)>-1?a:(0,n.isLikeNumber)(a)?Number(a):a}));const o={};return(0,s.forEach)(a,((e,t)=>{(0,s.set)(o,t.replace(/\./g,"."),e)})),o}toCreateParam(e,t){return o.__awaiter(this,void 0,void 0,(function*(){const a=(0,n.matchPath)(e),{resource:r,resourceSchema:o}=a[a.length-1],i=yield this.schemaService.getSchemaCache();this.removeRelationFields(i,o,t);const s=i[o].columns.filter((e=>"reference"===e.column_type&&e.reference["x-unique"]));if(0===s.length)return{action:"create",resource:r,param:{data:t}};if(s.length>1)throw new Error("Not support multiple unique key");{const e=s[0];return{action:"update",resource:r,param:{data:t},"x-unique":e}}}))}removeRelationFields(e,t,a){const r=[],o=e[t];o&&Object.keys(a).forEach((e=>{var t;const a=o.columns&&o.columns.find((t=>t.name===e));if(a&&"reference"===a.column_type){const e=null===(t=a.reference)||void 0===t?void 0:t["x-relationField"];e&&r.push(e)}})),r.forEach((e=>{delete a[e]}))}};t.PrismaSchemaService=m,t.PrismaSchemaService=m=r=o.__decorate([(0,i.injectable)(),o.__param(0,(0,i.inject)(d.PrismaUtilsSymbol)),o.__param(1,(0,i.inject)(d.LegacySchemaServiceSymbol)),o.__param(2,(0,i.inject)("Factory<Logger>")),o.__metadata("design:paramtypes",[Object,Object,Function])],m)},2181:(e,t,a)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.PrismaUtils=void 0;const o=a(5584),i=a(5337),n=a(7253),s=a(3169);let c=r=class PrismaUtils{constructor(e,t){this.prisma=e,this.logger=t(r.name)}parseId(e,t){return o.__awaiter(this,void 0,void 0,(function*(){const a=(0,n.toModelName)(e);return"Int"===(yield this.prisma._getDmmf()).modelMap[a].fields.find((e=>"id"===e.name)).type&&"number"!=typeof t?parseInt(t):t}))}};t.PrismaUtils=c,t.PrismaUtils=c=r=o.__decorate([(0,i.injectable)(),o.__param(0,(0,i.inject)(s.PrismaClientSymbol)),o.__param(1,(0,i.inject)("Factory<Logger>")),o.__metadata("design:paramtypes",[Object,Function])],c)},8736:(e,t,a)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.SchemaService=void 0;const o=a(5584),i=a(5337),n=a(3169);let s=r=class SchemaService{constructor(e,t,a){this.modelSchemaFactory=t,this.czt=a,this.logger=e(r.name)}getSchema(){console.time("generate schema");const e=Object.keys(this.czt).reduce(((e,t)=>{const a=this.czt[t];if(["ZodObject"].indexOf(a.constructor.name)>-1){const r=this.modelSchemaFactory(a);e[t]=r.buildSchema().toSchema(t)}else this.logger.error("Wrong type",t);return e}),{});return this.schemaCache=e,console.timeEnd("generate schema"),e}getSchemaCache(){return o.__awaiter(this,void 0,void 0,(function*(){return this.schemaCache?this.schemaCache:(this.logger.log("schemaCache is empty, getSchema again."),this.getSchema())}))}};t.SchemaService=s,t.SchemaService=s=r=o.__decorate([(0,i.injectable)(),o.__param(0,(0,i.inject)("Factory<Logger>")),o.__param(1,(0,i.inject)("Factory<SchemaTransformer>")),o.__param(2,(0,i.inject)(n.CustomZodSchemaSymbol)),o.__metadata("design:paramtypes",[Function,Function,Object])],s)},7578:(e,t,a)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.SchemaTransformer=void 0;const o=a(5584),i=a(5337),n=a(7967),s=a(7253);let c=r=class SchemaTransformer{constructor(e){this.logger=e(r.name)}setZodType(e){this.zodType=e}buildSchema(){if(!this.zodType){const e="zodType is not initialized";throw this.logger.error(e),new Error(e)}return this.jsonschema=(0,n.zodToOpenAPI)(this.zodType),this}toSchema(e){var t,a;const r=(new n.SchemaTransformer).set(this.jsonschema).toJSON();if(!r.slug)throw new Error(`no slug, ${JSON.stringify(r)}`);return Object.assign(Object.assign({},r),{schema_name:e,columns:null===(t=r.columns)||void 0===t?void 0:t.filter((e=>"isDeleted"!==e.name)).map((e=>{var t;return Object.assign(Object.assign(Object.assign({},e),e["x-legacy"]),{prisma:(!(null===(t=null==e?void 0:e["x-legacy"])||void 0===t?void 0:t.prisma)||"false"!==e["x-legacy"].prisma)&&void 0})})),associations:null===(a=r.associations)||void 0===a?void 0:a.map((e=>Object.assign(Object.assign({},e),{schema_name:(0,s.modelNameToSchemaName)(e.model_name)})))})}};t.SchemaTransformer=c,t.SchemaTransformer=c=r=o.__decorate([(0,i.injectable)(),o.__param(0,(0,i.inject)("Factory<Logger>")),o.__metadata("design:paramtypes",[Function])],c)},744:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.convertSortAgToMotor=void 0,t.convertSortAgToMotor=function(e){return null!=e[0]?"asc"===e[0].sort?e[0].colId:"-"+e[0].colId:void 0}},7492:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.error=t.warn=t.info=t.debug=void 0;const a={0:"#c0392b",1:"#f39c12",3:"#00BCD4",4:"#ccc"};function r(e){return`\n  background: ${a[e]};\n  border-radius: 0.5em;\n  color: white;\n  font-weight: bold;\n  padding: 2px 0.5em;\n`}t.debug=function(e){return["%c debug ",r(4),"",e]},t.info=function(e){return["%c info ",r(3),"",e]},t.warn=function(e){return["%c warn ",r(1),"",e]},t.error=function(e){return["%c error ",r(0),"",e]}},8243:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CustomError=void 0;class CustomError extends Error{constructor(e,t,a){super(JSON.stringify({code:e,message:t})),this.message=JSON.stringify({code:e,message:t,extra:a})}}t.CustomError=CustomError},2818:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getTimeByDay=t.getTimeExpire=void 0;const r=a(5584),o=r.__importDefault(a(3824)),i=r.__importDefault(a(5789)),n=r.__importDefault(a(6167)),s=r.__importDefault(a(6293));s.default.extend(o.default),s.default.extend(i.default),s.default.extend(n.default),t.getTimeExpire=function(e){const t=(0,s.default)().tz("Asia/Shanghai").add(e,"minute").format("YYYY-MM-DDTHH:mm:ss+z").match(/.*(GMT\+(\d))/);return null==t?"":t[0].replace(t[1],t[2].padStart(2,"0")+":00")},t.getTimeByDay=function(e){return(0,s.default)().tz("Asia/Shanghai").add(e,"day").toDate()}},7253:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.matchPath=t.modelNameToSchemaName=t.toSchemaName=t.toPath=t.toModelName=t.isLikeNumber=void 0;const r=a(5584),o=r.__importStar(a(452)),i=r.__importStar(a(7825));o.addSingularRule(/data$/i,"data"),o.addPluralRule(/data$/i,"data"),o.addSingularRule(/def$/i,"def"),o.addPluralRule(/def$/i,"def"),o.addSingularRule(/sms$/i,"sms"),o.addPluralRule(/sms$/i,"sms"),o.addSingularRule(/ProjectUsers$/i,"ProjectUsers"),o.addPluralRule(/ProjectUsers$/i,"ProjectUsers");const n=/(([a-z_]+s*)\/?([A-Za-z0-9-_:]+)?)+/g,s=/^-?\d+(\.\d+)?$/;function c(e){return s.test(e)}function d(e){return i.startCase(i.camelCase(o.singular(e))).replace(/ /g,"")}function m(e){return d(o.singular(e))+"ResourceSchema"}t.isLikeNumber=c,t.toModelName=d,t.toPath=function(e){return o.plural(i.snakeCase(e))},t.toSchemaName=m,t.modelNameToSchemaName=function(e){return o.singular(e)+"ResourceSchema"},t.matchPath=function(e){const t=e.match(n);if(null!=t){return t.map((e=>{const[t,a]=e.split("/"),r=o.singular(t);return{resource:i.camelCase(r),resourceSchema:m(t),origin:t,id:c(a)?i.toNumber(a):a}}))}return[]}},5316:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getSchemaByDisplayName=void 0,t.getSchemaByDisplayName=function(e,t){const a=Object.keys(e).find((a=>e[a].display_name===t));return a?e[a]:null}},7967:e=>{e.exports=require("@flowda/schema")},3169:e=>{e.exports=require("@flowda/types")},3563:e=>{e.exports=require("@nestjs/common")},8781:e=>{e.exports=require("@nestjs/core")},7455:e=>{e.exports=require("@trpc/client")},3611:e=>{e.exports=require("@trpc/server")},6951:e=>{e.exports=require("@trpc/server/adapters/express")},8938:e=>{e.exports=require("axios")},9797:e=>{e.exports=require("consola")},6293:e=>{e.exports=require("dayjs")},6167:e=>{e.exports=require("dayjs/plugin/advancedFormat")},5789:e=>{e.exports=require("dayjs/plugin/timezone")},3824:e=>{e.exports=require("dayjs/plugin/utc")},7016:e=>{e.exports=require("http-proxy-middleware")},5337:e=>{e.exports=require("inversify")},7825:e=>{e.exports=require("lodash")},2377:e=>{e.exports=require("nestjs-zod")},452:e=>{e.exports=require("pluralize")},8340:e=>{e.exports=require("qs")},6557:e=>{e.exports=require("radash")},5584:e=>{e.exports=require("tslib")},3238:e=>{e.exports=require("znv")},1569:e=>{e.exports=require("zod")}},t={};function a(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,a),i.exports}var r={};(()=>{var e=r;Object.defineProperty(e,"__esModule",{value:!0});const t=a(5584),o=a(3563),i=a(8781),n=a(9238),s=a(4424),c=a(7016);!function(){t.__awaiter(this,void 0,void 0,(function*(){const e=yield i.NestFactory.create(n.AppModule);e.enableCors();const t="flowda-gateway-api";e.setGlobalPrefix(t);e.get(s.TrpcRouter).applyMiddleware(e,t),e.use(((e,t,a)=>{e.originalUrl.includes("favicon.ico")?t.status(204).end():a()})),e.use(`/${t}/camunda/engine-rest`,(0,c.createProxyMiddleware)({logLevel:"debug",target:s.FLOWDA_GATEWAY_ENV.FLOWDA_URL,changeOrigin:!0,pathRewrite:{"^/flowda-gateway-api":"/flowda-api"}}));const a=process.env.PORT||3310;yield e.listen(a),o.Logger.log(`\ud83d\ude80 Application is running on: http://localhost:${a}/${t}`)}))}()})();var o=exports;for(var i in r)o[i]=r[i];r.__esModule&&Object.defineProperty(o,"__esModule",{value:!0})})();
//# sourceMappingURL=main.js.map